<app-title></app-title>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow">
        <div class="card-body p-4">

          <p class="text-center text-muted mb-4">
            <strong>Compila il form per inviarmi un messaggio o chiedere un appuntamento</strong>
          </p>

          <!-- ‚úÖ Alert Success -->
          @if (submitSuccess) {
          <div class="alert alert-success d-flex align-items-center" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <div>Messaggio inviato con successo!</div>
          </div>
          }

          <!-- ‚ùå Alert Error -->
          @if (submitError) {
          <div class="alert alert-danger d-flex align-items-center" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <div>Errore nell'invio. Riprova pi√π tardi.</div>
          </div>
          }

          <form [formGroup]="contactForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <!-- Nome -->
              <div class="col-md-6 mb-3">
                <label for="nome" class="form-label">Nome <span>*</span></label>
                <input
                  id="nome"
                  type="text"
                  class="form-control"
                  placeholder="Inserisci il tuo nome"
                  formControlName="nome"
                  [class.is-invalid]="contactForm.get('nome')?.invalid && contactForm.get('nome')?.touched" />
                @if (contactForm.get('nome')?.invalid && contactForm.get('nome')?.touched) {
                  <div class="invalid-feedback">Il nome √® obbligatorio</div>
                }
              </div>

              <!-- Cognome -->
              <div class="col-md-6 mb-3">
                <label for="cognome" class="form-label">Cognome <span>*</span></label>
                <input
                  id="cognome"
                  type="text"
                  class="form-control"
                  placeholder="Inserisci il tuo cognome"
                  formControlName="cognome"
                  [class.is-invalid]="contactForm.get('cognome')?.invalid && contactForm.get('cognome')?.touched" />
                @if (contactForm.get('cognome')?.invalid && contactForm.get('cognome')?.touched) {
                  <div class="invalid-feedback">Il cognome √® obbligatorio</div>
                }
              </div>
            </div>

            <div class="row">
              <!-- Et√† -->
              <div class="col-md-6 mb-3">
                <label for="eta" class="form-label">Et√† <span>*</span></label>
                <input
                  id="eta"
                  type="number"
                  class="form-control"
                  placeholder="Inserisci la tua et√†"
                  formControlName="eta"
                  [class.is-invalid]="contactForm.get('eta')?.invalid && contactForm.get('eta')?.touched" />
                @if (contactForm.get('eta')?.invalid && contactForm.get('eta')?.touched) {
                  <div class="invalid-feedback">
                    @if (contactForm.get('eta')?.errors?.['required']) {
                      <span>L'et√† √® obbligatoria</span>
                    }
                    @if (contactForm.get('eta')?.errors?.['min']) {
                      <span>L'et√† deve essere maggiore di 0</span>
                    }
                    @if (contactForm.get('eta')?.errors?.['max']) {
                      <span>L'et√† deve essere minore di 150</span>
                    }
                  </div>
                }
              </div>

              <!-- Email -->
              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">Email <span>*</span></label>
                <input
                  id="email"
                  type="email"
                  class="form-control"
                  placeholder="nome@esempio.com"
                  formControlName="email"
                  [class.is-invalid]="contactForm.get('email')?.invalid && contactForm.get('email')?.touched" />
                @if (contactForm.get('email')?.invalid && contactForm.get('email')?.touched) {
                  <div class="invalid-feedback">
                    @if (contactForm.get('email')?.errors?.['required']) {
                      <span>L'email √® obbligatoria</span>
                    }
                    @if (contactForm.get('email')?.errors?.['email']) {
                      <span>Inserisci un'email valida</span>
                    }
                  </div>
                }
              </div>
            </div>

            <!-- Messaggio -->
            <div class="mb-3">
              <label for="messaggio" class="form-label">Messaggio <span>*</span></label>
              <textarea
                id="messaggio"
                rows="5"
                class="form-control"
                placeholder="Scrivi il tuo messaggio..."
                formControlName="messaggio"
                [class.is-invalid]="contactForm.get('messaggio')?.invalid && contactForm.get('messaggio')?.touched">
              </textarea>
              @if (contactForm.get('messaggio')?.invalid && contactForm.get('messaggio')?.touched) {
                <div class="invalid-feedback">Il messaggio √® obbligatorio</div>
              }
            </div>

            <!-- Privacy -->
            <div class="mb-4">
              <div class="form-check">
                <input
                  id="privacy"
                  type="checkbox"
                  class="form-check-input"
                  formControlName="privacy"
                  [class.is-invalid]="contactForm.get('privacy')?.invalid && contactForm.get('privacy')?.touched" />
                <label class="form-check-label" for="privacy">
                  Accetto il trattamento dei dati personali secondo la
                  <a routerLink="/privacy" class="text-decoration-none">Privacy Policy</a>
                  <span>*</span>
                </label>
                @if (contactForm.get('privacy')?.invalid && contactForm.get('privacy')?.touched) {
                  <div class="invalid-feedback d-block">
                    Devi accettare la privacy policy per continuare
                  </div>
                }
              </div>
            </div>

            <!-- üîí Google reCAPTCHA -->
            <div class="d-flex justify-content-center mb-4">
              <div id="recaptcha-container"></div>
            </div>

            <!-- Pulsante invio -->
            <div class="text-center">
              <button type="submit" class="btn btn-primary btn-lg px-5" [disabled]="isSubmitting">
                @if (!isSubmitting) {
                  <span>Invia Messaggio</span>
                } @else {
                  <span>
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Invio in corso...
                  </span>
                }
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>
